---
title: "Lecture 12"
author: "Reuben Berkowitz"
date: "2024-10-14"
output: html_document
---

## Pivot Longer

```{r}
library(tidyverse)
library(ps270data)
mortality
```

pivot_longer to convert data set into long format

mydata |>
  pivot_longer(cols = <variables to pivot>,
                names_to = <new variable to put column names>,
                values_to = <new variable to put column values>)

```{r}
mortality |>
  select(-indicator) |>
  pivot_longer(cols = `1972`:`2020`,
               names_to = "year",
               values_to = "child_mortality")
```

line plot time

```{r}
mortality |>
  select(-indicator) |>
  pivot_longer(cols = `1972`:`2020`,
               names_to = "year",
               values_to = "child_mortality") |>
  mutate(year = as.integer(year)) |>
  ggplot(mapping = aes(x = year, y = child_mortality, group = country)) + 
  geom_line(alpha = 0.25)
```

practice pivot_longer on another dataset


```{r}
spotify
```


```{r}
spotify |>
  pivot_longer(cols = c(`week1`:`week52`),
               names_to = "week_of_year",
               values_to = "rank") |>
  mutate(week_of_year = as.integer(week_of_year))
```
## Joining Data Sets

```{r}
library(gapminder)
gapminder
```

first, assign our pivoted mortality data to the object mortality_long

```{r}
mortality_long <- mortality |>
  select(-indicator) |>
  pivot_longer(cols = `1972`:`2020`,
               names_to = "year",
               values_to = "child_mortality") |>
  mutate(year = as.integer(year))
```

check that keys are unique

```{r}
gapminder |>
  count(country, year) |>
  filter(n > 1)
```

same for the other data

```{r}
mortality_long |>
  count(country, year) |>
  filter(n > 1)
```

first use the left_join() function

```{r}
gapminder |>
  left_join(mortality_long) 
```

an alternative is inner_join(), which does something slightly different

```{r}
gapminder |>
  inner_join(mortality_long)
```

loading data for a more complicated example

```{r}
library(nycflights13)
planes
```

```{r}
flights |>
  left_join(planes, by = "tailnum")
```





